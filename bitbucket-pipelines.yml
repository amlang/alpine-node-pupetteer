image: atlassian/default-image:2
pipelines:
  default:
    - step:
        services:
          - docker
        script:
          - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
          - echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
          - apt-key adv --refresh-keys --keyserver ha.pool.sks-keyservers.net
          - apt-get update && apt-get install yarn
          - export IMAGE_NAME=ivyowl/alpine-node-pupetteer
          - yarn build:all
          - docker login --username $DOCKER_HUB_USERNAME --password $DOCKER_HUB_PASSWORD
          - docker push $IMAGE_NAME
